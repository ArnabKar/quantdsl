language: python

sudo: false

#services:
#  - rabbitmq


# Travis whitelists the installable packages, additions can be requested
#   https://github.com/travis-ci/apt-package-whitelist
addons:
  apt:
    packages: &common_packages
      - gfortran
      - libatlas-dev
      - libatlas-base-dev
      # Speedup builds, particularly when USE_CHROOT=1
      - eatmydata

cache:
  directories:
    - $HOME/.cache/pip

env:
  global:
    - WHEELHOUSE_UPLOADER_USERNAME=travis.numpy
    # The following is generated with the command:
    # travis encrypt -r numpy/numpy WHEELHOUSE_UPLOADER_SECRET=tH3AP1KeY
    - secure: "IEicLPrP2uW+jW51GRwkONQpdPqMVtQL5bdroqR/U8r9Tr\
               XrbCVRhp4AP8JYZT0ptoBpmZWWGjmKBndB68QlMiUjQPow\
               iFWt9Ka92CaqYdU7nqfWp9VImSndPmssjmCXJ1v1IjZPAM\
               ahp7Qnm0rWRmA0z9SomuRUQOJQ6s684vU="

python:
  - 2.7
  - 3.4
  - 3.5
  - 3.6
matrix:
  include:
    - python: 2.7
      env: USE_CHROOT=1 ARCH=i386 DIST=zesty PYTHON=2.7
      sudo: true
      dist: trusty
      addons:
        apt:
          packages:
            - debootstrap
    - python: 3.4
      env: USE_DEBUG=1
      dist: trusty
      addons:
        apt:
          packages:
            - *common_packages
            - cython3-dbg
            - python3-dbg
            - python3-dev
            - python3-nose
            - python3-setuptools
    - python: 3.5
      env: USE_WHEEL=1 RUN_FULL_TESTS=1
    - python: 3.5
      env: USE_SDIST=1
    - python: 2.7
      env:
       - PYTHONOPTIMIZE=2
       - USE_ASV=1
    - python: 2.7
      env: NPY_RELAXED_STRIDES_CHECKING=0 PYTHON_OPTS="-3 -OO"
    - python: 2.7
      env: USE_WHEEL=1 NPY_RELAXED_STRIDES_DEBUG=1
    - python: 2.7
      env:
       - BLAS=None
       - LAPACK=None
       - ATLAS=None

#python:
#  - "2.7"
##  - "3.3"  Matplotlib doesn't support this version of Python.
#  - "3.4"
#  - "3.5"
#  - "3.5-dev"
#  - "3.6"
#  - "3.6-dev"
#  - "3.7-dev"

#before_install:
#- travis_retry wget http://repo.continuum.io/miniconda/Miniconda-3.8.3-Linux-x86_64.sh -O miniconda.sh
#- chmod +x miniconda.sh
#- bash miniconda.sh -b -p $HOME/miniconda
#- export PATH=/home/travis/miniconda/bin:$PATH
#- conda update --yes conda
#- conda install --yes atlas numpy scipy matplotlib

install:
- pip install -U pip
- pip install .
- pip install python-coveralls

script:
- echo "Python version:"
- python --version
- coverage run -m unittest discover quantdsl.tests -v

after_success:
- coveralls
